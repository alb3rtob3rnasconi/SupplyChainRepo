<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisi Econometrica - Cimplasta SrL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-[#1F2937] text-white py-12 px-6 shadow-lg border-b-4 border-[#0891B2]">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h2 class="text-cyan-400 font-bold tracking-wider uppercase text-sm mb-2">Appendice Dati</h2>
                    <h1 class="text-3xl md:text-5xl font-bold mb-4">Analisi Econometrica Logistica</h1>
                    <p class="text-xl text-gray-300 max-w-2xl text-justify">Rappresentazione grafica delle performance degli spedizionieri, scomposizione dei costi e analisi differenziale dei margini per Cimplasta SrL.</p>
                </div>
                <div class="mt-6 md:mt-0 flex flex-col items-end">
                    <a href="index.html" class="px-4 py-2 bg-transparent border border-white text-white text-sm font-semibold rounded-lg hover:bg-white hover:text-[#1F2937] transition-colors mb-4">⬅ Torna al Documento Principale</a>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-sm border border-white/20 text-right w-full">
                        <span class="block text-xl font-bold">Cimplasta SrL</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-10 space-y-12">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <section class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-[#4C1D95] mb-2">Analisi Comparativa Spedizionieri</h3>
                <p class="text-sm text-slate-600 mb-6 text-justify">
                    Mappa di posizionamento dei principali player operanti sul mercato italiano. L'analisi incrocia il costo medio per la singola spedizione sull'asse orizzontale con la velocità di consegna misurata in giorni sull'asse verticale. La dimensione della bolla indica in modo proporzionale l'affidabilità generale del corriere, calcolata sul minor tasso di resi o danni alla merce.
                </p>
                <div class="chart-container">
                    <canvas id="courierScatterChart"></canvas>
                </div>
                <div class="mt-4 text-xs text-slate-400 text-center">
                    Fonte: Analisi Preventivi Q1 2024 - Spedizioni 0-3kg Nazionali
                </div>
            </section>

            <section class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-[#4C1D95] mb-2">Composizione del Costo Logistico</h3>
                <p class="text-sm text-slate-600 mb-6 text-justify">
                    In un modello di logistica completamente esternalizzata, il costo unitario non è rappresentato solamente dalla spedizione nuda e cruda. Questo grafico illustra con precisione l'incidenza in percentuale delle varie voci di spesa relative alla gestione del singolo ordine da parte del partner 3PL.
                </p>
                <div class="chart-container">
                    <canvas id="costBreakdownChart"></canvas>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#4C1D95] mr-2"></span>Tariffa Spedizione (Base)</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#DB2777] mr-2"></span>Picking & Packing</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#0891B2] mr-2"></span>Materiali Imballo</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-[#D97706] mr-2"></span>Fuel Surcharge & Assicurazione</div>
                </div>
            </section>
        </div>

        <section class="bg-white rounded-xl shadow-md p-8 border-l-8 border-[#0891B2]">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6">
                <div class="md:w-2/3">
                    <h3 class="text-2xl font-bold text-[#0891B2] mb-2">Analisi Margine: Gestione Interna vs Outsourcing</h3>
                    <p class="text-slate-600 text-justify">
                        Confronto diretto per valutare la struttura del margine operativo. Sebbene l'outsourcing introduca inevitabilmente una tariffa di gestione aggiuntiva per il confezionamento dei prodotti, il conseguente accesso alle tariffe di spedizione agevolate del partner 3PL compensa i costi di elaborazione, garantendo la stabilizzazione e il miglioramento del margine netto aziendale sul singolo ordine.
                    </p>
                </div>
                <div class="mt-4 md:mt-0 px-4 py-2 bg-green-100 text-green-800 rounded-lg font-bold text-sm shrink-0">
                    Obiettivo: Margine Netto > 22%
                </div>
            </div>
            
            <div class="chart-container h-96">
                <canvas id="marginStackChart"></canvas>
            </div>
        </section>

    </main>

    <script>
        // --- UTILITY: Label Splitter for Chart.js (>16 chars) ---
        function splitLabel(label) {
            if (label.length <= 16) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= 16) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- COMMON: Tooltip Configuration ---
        const commonTooltip = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        const commonFont = {
            family: "'Inter', sans-serif",
            size: 12
        };

        // --- CHART 1: Scatter Plot (Couriers) ---
        const ctxScatter = document.getElementById('courierScatterChart').getContext('2d');
        new Chart(ctxScatter, {
            type: 'scatter',
            data: {
                labels: ['BRT/DPD', 'GLS Executive', 'DHL Express', 'UPS Standard', 'Poste/SDA'],
                datasets: [{
                    label: 'Performance Spedizionieri',
                    data: [
                        { x: 5.50, y: 2.1, r: 15 },
                        { x: 6.20, y: 1.8, r: 18 },
                        { x: 12.00, y: 1.1, r: 25 },
                        { x: 9.50, y: 1.5, r: 22 },
                        { x: 4.90, y: 3.5, r: 10 }
                    ],
                    backgroundColor: [
                        'rgba(217, 119, 6, 0.7)',
                        'rgba(8, 145, 178, 0.7)',
                        'rgba(219, 39, 119, 0.7)',
                        'rgba(76, 29, 149, 0.7)',
                        'rgba(156, 163, 175, 0.7)'
                    ],
                    borderColor: 'rgba(255,255,255,1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const labels = ['BRT/DPD', 'GLS Executive', 'DHL Express', 'UPS Standard', 'Poste/SDA'];
                                return labels[context.dataIndex] + ': €' + context.raw.x + ' / ' + context.raw.y + ' gg';
                            }
                        }
                    },
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Costo Medio Spedizione (€)', color: '#4B5563' },
                        min: 3,
                        max: 14,
                        grid: { display: false }
                    },
                    y: {
                        title: { display: true, text: 'Tempi di Consegna Medi (Giorni)', color: '#4B5563' },
                        min: 0,
                        max: 5,
                        reverse: false
                    }
                }
            }
        });

        // --- CHART 2: Donut (Cost Breakdown) ---
        const ctxDonut = document.getElementById('costBreakdownChart').getContext('2d');
        const donutLabels = ['Tariffa Spedizione Base', 'Picking & Packing (3PL)', 'Materiali Imballaggio', 'Fuel & Assicurazione'].map(splitLabel);
        
        new Chart(ctxDonut, {
            type: 'doughnut',
            data: {
                labels: donutLabels,
                datasets: [{
                    data: [55, 25, 12, 8],
                    backgroundColor: ['#4C1D95', '#DB2777', '#0891B2', '#D97706'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: commonTooltip,
                    legend: {
                        position: 'right',
                        labels: { font: commonFont, boxWidth: 12 }
                    }
                }
            }
        });

        // --- CHART 3: Stacked Bar (Margin Analysis) ---
        const ctxStack = document.getElementById('marginStackChart').getContext('2d');
        const stackLabels = ['Gestione Interna (Corriere Standard)', 'Outsourcing 3PL (Tariffa Partner)'].map(splitLabel);

        new Chart(ctxStack, {
            type: 'bar',
            data: {
                labels: stackLabels,
                datasets: [
                    {
                        label: 'Costo Prodotto',
                        data: [15, 15],
                        backgroundColor: '#9CA3AF',
                    },
                    {
                        label: 'Costo Logistico Totale',
                        data: [12, 9.5],
                        backgroundColor: '#DB2777',
                    },
                    {
                        label: 'Costi Marketing/Stripe',
                        data: [5, 5],
                        backgroundColor: '#D97706',
                    },
                    {
                        label: 'Margine Netto Aziendale',
                        data: [8, 10.5],
                        backgroundColor: '#0891B2',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: commonTooltip,
                    legend: { position: 'bottom' }
                },
                scales: {
                    x: { stacked: true, grid: { display: false } },
                    y: { 
                        stacked: true,
                        title: { display: true, text: 'Valore Ordine Medio (€40)' },
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>